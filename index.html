<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>百人一首早押し課題</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app">
        <!-- SCREEN: Welcome & Metadata -->
        <div id="screen-welcome" class="screen active">
            <h1>百人一首 聞き分け実験</h1>
            <p>実験者から案内された情報を入力して、「次へ」を押してください。</p>
            <div class="form-group">
                <label for="participant-id">参加者ID (大文字小文字を区別しません):</label>
                <input type="text" id="participant-id" placeholder="例：P001">
            </div>
            <div class="form-group">
                <label for="input-device">ボタンの押し方:</label>
                <select id="input-device">
                    <option value="mouse">マウスでクリック</option>
                    <option value="keyboard">キーボード（スペースキー）</option>
                    <option value="touch">タッチ操作</option>
                </select>
            </div>
            <div class="form-group">
                <label for="reader-select">読手:</label>
                <select id="reader-select">
                    <option value="sounds_kimoto">木本 景子さん</option>
                    <option value="sounds_Inaba">難波津いなばくん</option>
                </select>
            </div>
            <div class="form-group" style="font-size: 0.85em; color: #888;">
                <input type="checkbox" id="test-mode-toggle">
                <label for="test-mode-toggle">テストモード（動作確認用）</label>
            </div>
            <button id="btn-start-motor">次へ</button>
        </div>

        <!-- SCREEN: Loading -->
        <div id="screen-loading" class="screen">
            <h2>準備中...</h2>
            <p>しばらくお待ちください。</p>
            <div class="loader"></div>
        </div>

        <!-- SCREEN: Motor Calibration -->
        <div id="screen-motor" class="screen">
            <h2>ステップ 1：反応速度の計測</h2>
            <p>「ピッ」という音が聞こえた瞬間に、できるだけ素早く下のボタンを押してください。</p>
            <p style="font-size: 0.9em; color: #666;"><strong><span id="motor-total-trials">--</span> 回</strong>繰り返します（現在 <span id="motor-counter">0</span> 回目）</p>
            <div id="motor-area-container">
                <button id="btn-start-calibration">計測を開始する</button>
                <div id="motor-area" style="display: none;">
                    <p>音が聞こえたらここを押す</p>
                </div>
            </div>
        </div>

        <!-- SCREEN: Main Task Instruction -->
        <div id="screen-main-intro" class="screen">
            <h2>ステップ 2：本課題</h2>
            <p>これから百人一首の歌を聴いてもらいます。</p>
            <ol style="text-align: left; line-height: 2em;">
                <li>序歌の終わりの部分が流れます。それが合図です。</li>
                <li>歌が<strong>「何の歌かわかった」と思った瞬間に、すぐにボタンを押してください。</strong></li>
                <li>歌が止まったら、どの歌だったか答えてください。</li>
            </ol>
            <p style="font-size: 0.9em; color: #666;">わからなかった場合は「わからない」ボタンを押してください。</p>
            <button id="btn-start-main">本課題を開始する</button>
        </div>

        <!-- SCREEN: Trial (Play & Press) -->
        <div id="screen-trial" class="screen">
            <h2>歌が流れます。聴いてください。</h2>
            <p style="color: #888; font-size: 0.9em;">試行 <span id="trial-counter">0</span> / <span id="total-trials">--</span></p>
            <div id="press-button">わかった瞬間に押す！<br><span style="font-size: 0.6em; color: #888;">（クリック または スペースキー）</span></div>
        </div>

        <!-- SCREEN: Choice -->
        <div id="screen-choice" class="screen">
            <h2>何の歌でしたか？ — 頭文字を選んでください</h2>
            <div id="choice-container">
                <div id="choice-step-1-initials" class="choice-step active">
                    <!-- First-letter (initial) buttons will be injected here -->
                </div>
                <div id="choice-step-2-candidates" class="choice-step">
                    <!-- Candidate buttons will be injected here -->
                </div>
            </div>
            <div class="choice-controls">
                <button id="btn-unknown-global" class="btn-secondary">わからない（後でもう一度流れます）</button>
            </div>
        </div>

        <!-- SCREEN: Break -->
        <div id="screen-break" class="screen">
            <h2>休憩</h2>
            <p>一息ついてください。</p>
            <button id="btn-resume">再開する</button>
        </div>

        <!-- SCREEN: Results -->
        <div id="screen-results" class="screen">
            <h2>実験終了</h2>
            <p>ご協力ありがとうございました。</p>
            <div id="results-stats"></div>
            <p id="save-status"></p>
        </div>
    </div>

    <!-- Firebase SDKs (Placeholder) -->
    <!-- <script type="module" src="firebase-config.js"></script> -->
    <script src="script.js?v=20260223_01"></script>
</body>
<!-- redeploy -->
